<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Yâ€‘map ë§›ì§‘ ì§€ë„</title>

  <!-- Leaflet CDN -->
  <link
    rel="stylesheet"
    href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css"
  />
  <style>
    body{margin:0;font-family:sans-serif;}
    header{
      background:#ff6347;color:#fff;padding:12px 16px;font-size:20px;
      display:flex;align-items:center;gap:12px;flex-wrap:wrap;
    }
    #brand{font-weight:700;font-size:22px;margin-right:auto;}
    #search{flex:1;min-width:160px;max-width:280px;padding:6px 10px;
            border:none;border-radius:4px;}
    button.head-btn{
      background:#fff;border:none;border-radius:4px;padding:6px 14px;
      cursor:pointer;font-weight:600;
    }
    #map  {width:100%;height:60vh;}
    #list {padding:12px;}
    .place{cursor:pointer;margin:4px 0;padding:6px;border-bottom:1px solid #eee;}
    .place-name{font-weight:600}
    .hidden{display:none;}
    .footer{text-align:center;font-size:14px;padding:8px;color:#666;}
    /* ê°„ë‹¨ ëª¨ë‹¬ */
    .modal-back{position:fixed;top:0;left:0;right:0;bottom:0;
      background:rgba(0,0,0,.4);display:flex;align-items:center;
      justify-content:center;z-index:999;display:none;}
    .modal{background:#fff;padding:24px;border-radius:8px;min-width:260px;}
    .modal h3{margin-top:0;}
  </style>
</head>

<body>
  <!-- â”€â”€ í—¤ë” â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ -->
  <header>
    <span id="brand">ğŸœâ€¯Yâ€‘map</span>
    <input id="search" type="text" placeholder="ë§›ì§‘ ê²€ìƒ‰ (ì´ë¦„Â·ì£¼ì†Œ)" />
    <button class="head-btn" id="nearbyBtn">ë‚´ ì£¼ë³€</button>
    <button class="head-btn" id="loginBtn">ë¡œê·¸ì¸</button>
    <button class="head-btn" id="joinBtn">íšŒì›ê°€ì…</button>
  </header>

  <!-- â”€â”€ ì§€ë„ & ë¦¬ìŠ¤íŠ¸ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ -->
  <div id="map"></div>
  <div id="list"></div>
  <div class="footer">poweredÂ byÂ LeafletÂ &Â OpenStreetMap</div>

  <!-- â”€â”€ ëª¨ë‹¬ (ë¡œê·¸ì¸/íšŒì›ê°€ì… placeholder) â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ -->
  <div class="modal-back" id="modalBack">
    <div class="modal">
      <h3 id="modalTitle"></h3>
      <p>ë°ëª¨ìš© UIì…ë‹ˆë‹¤. ë°±ì—”ë“œ ì—°ê²° í›„ êµ¬í˜„í•˜ì„¸ìš” ğŸ™‚</p>
      <button class="head-btn" onclick="modalBack.style.display='none'">ë‹«ê¸°</button>
    </div>
  </div>

  <!-- â”€â”€ Leaflet JS â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ -->
  <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js" defer></script>

  <!-- â”€â”€ ì•± ìŠ¤í¬ë¦½íŠ¸ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ -->
  <script defer>
  window.addEventListener('DOMContentLoaded', () => {
    if (!window.L) { alert('Leaflet ë¡œë“œ ì‹¤íŒ¨'); return; }

    /* 1) ì§€ë„ ------------------------------------------------------------ */
    const map = L.map('map').setView([37.5665, 126.9780], 13);
    L.tileLayer(
      'https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png',
      { attribution:'Â© OpenStreetMap' }
    ).addTo(map);

    /* 2) ë§›ì§‘ ë°ì´í„° ----------------------------------------------------- */
    const places = [
      { name:'ëª¨ì°Œë¼ë©˜',  addr:'ì„œìš¸ ì¤‘êµ¬ ì„¸ì¢…ëŒ€ë¡œ', lat:37.5665, lng:126.9780 },
      { name:'ì¹´ë ˆì§±',    addr:'ì„œìš¸ ì¤‘êµ¬ ì¶©ë¬´ë¡œ',   lat:37.5651, lng:126.9895 },
      { name:'ê³±ì°½ì˜ ì •ì„', addr:'ì„œìš¸ ì¤‘êµ¬ ëª…ë™',   lat:37.5670, lng:126.9820 },
      { name:'ëˆì¹´ì¸ ëª…ê°€', addr:'ì„œìš¸ ìš©ì‚°êµ¬ ì´íƒœì›', lat:37.5345, lng:126.9940 },
      { name:'ëª¨ì°Œì¹´í˜',  addr:'ì„œìš¸ ê°•ë‚¨êµ¬ ê°•ë‚¨ëŒ€ë¡œ',lat:37.4980, lng:127.0276 }
    ];

    /* 3) ë§ˆì»¤Â·ë¦¬ìŠ¤íŠ¸ ---------------------------- */
    const listDiv   = document.getElementById('list');
    const markers   = [];
    const addPlace  = p => {
      const marker = L.marker([p.lat, p.lng])
        .bindPopup(`<strong>${p.name}</strong><br>${p.addr}`).addTo(map);

      const item = document.createElement('div');
      item.className = 'place';
      item.innerHTML = `<div class="place-name">${p.name}</div>
                        <div class="place-addr">${p.addr}</div>`;
      item.addEventListener('click', () => {
        map.setView([p.lat, p.lng], 17);
        marker.openPopup();
      });
      listDiv.appendChild(item);
      markers.push({marker,item,data:p});
    };
    places.forEach(addPlace);

    /* 4) ê²€ìƒ‰ í•„í„° -------------------------------- */
    const searchInput = document.getElementById('search');
    searchInput.addEventListener('input', () => {
      const q = searchInput.value.trim().toLowerCase();
      markers.forEach(obj => {
        const match = (obj.data.name+obj.data.addr).toLowerCase().includes(q);
        obj.item.classList.toggle('hidden', !match);
        match ? map.addLayer(obj.marker) : map.removeLayer(obj.marker);
      });
    });

    /* 5) ë‚´ ì£¼ë³€ ì¶”ì²œ ----------------------------- */
    const nearBtn = document.getElementById('nearbyBtn');
    nearBtn.addEventListener('click', () => {
      if (!navigator.geolocation) {
        alert('ì´ ë¸Œë¼ìš°ì €ëŠ” ìœ„ì¹˜ ì„œë¹„ìŠ¤ë¥¼ ì§€ì›í•˜ì§€ ì•ŠìŠµë‹ˆë‹¤.');
        return;
      }
      navigator.geolocation.getCurrentPosition(pos => {
        const {latitude, longitude} = pos.coords;
        const userLatLng = L.latLng(latitude, longitude);

        // â‘  ì‚¬ìš©ì ìœ„ì¹˜ ë§ˆì»¤
        L.marker(userLatLng, {icon:L.icon({
          iconUrl:'https://unpkg.com/leaflet@1.9.4/dist/images/marker-icon.png',
          iconAnchor:[12,41],popupAnchor:[0,-38]
        })}).addTo(map)
          .bindPopup('ë‚´ ìœ„ì¹˜').openPopup();

        // â‘¡ ê±°ë¦¬ ê³„ì‚°í•˜ì—¬ 2km ì´ë‚´ë§Œ ì¶”ì²œ
        const nearby = markers.filter(o => {
          return userLatLng.distanceTo([o.data.lat, o.data.lng]) <= 2000;
        });

        if (nearby.length===0){
          alert('ë°˜ê²½ 2km ë‚´ ì¶”ì²œ ë§›ì§‘ì´ ì—†ì–´ìš” ğŸ˜¢');
          return;
        }

        // â‘¢ ì „ì²´ ë§ˆì»¤/ë¦¬ìŠ¤íŠ¸ ìˆ¨ê¸°ê³ , ê°€ê¹Œìš´ ê²ƒë§Œ ë³´ì—¬ì£¼ê¸°
        markers.forEach(o=>{
          o.item.classList.add('hidden');
          map.removeLayer(o.marker);
        });
        nearby.forEach(o=>{
          o.item.classList.remove('hidden');
          map.addLayer(o.marker);
        });

        // â‘£ ì§€ë„ ì¤‘ì‹¬ ì´ë™
        map.setView(userLatLng, 15);
      }, err => {
        alert('ìœ„ì¹˜ ì ‘ê·¼ì´ ê±°ë¶€ë˜ì—ˆìŠµë‹ˆë‹¤ ğŸ˜¢');
      });
    });

    /* 6) ë¡œê·¸ì¸/íšŒì›ê°€ì… í”Œë˜ê·¸ ëª¨ë‹¬ ------------- */
    const modalBack = document.getElementById('modalBack');
    const modalTitle= document.getElementById('modalTitle');
    const openModal = title => {
      modalTitle.textContent = title;
      modalBack.style.display = 'flex';
    };
    document.getElementById('loginBtn').onclick = () => openModal('ë¡œê·¸ì¸');
    document.getElementById('joinBtn').onclick  = () => openModal('íšŒì›ê°€ì…');
  });
  </script>
</body>
</html>