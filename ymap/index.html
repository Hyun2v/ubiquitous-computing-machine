<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Y‑map 맛집 지도</title>

  <!-- Leaflet CDN -->
  <link
    rel="stylesheet"
    href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css"
  />
  <style>
    body{margin:0;font-family:sans-serif;}
    header{
      background:#ff6347;color:#fff;padding:12px 16px;font-size:20px;
      display:flex;align-items:center;gap:12px;flex-wrap:wrap;
    }
    #brand{font-weight:700;font-size:22px;margin-right:auto;}
    #search{flex:1;min-width:160px;max-width:280px;padding:6px 10px;
            border:none;border-radius:4px;}
    button.head-btn{
      background:#fff;border:none;border-radius:4px;padding:6px 14px;
      cursor:pointer;font-weight:600;
    }
    #map  {width:100%;height:60vh;}
    #list {padding:12px;}
    .place{cursor:pointer;margin:4px 0;padding:6px;border-bottom:1px solid #eee;}
    .place-name{font-weight:600}
    .hidden{display:none;}
    .footer{text-align:center;font-size:14px;padding:8px;color:#666;}
    /* 간단 모달 */
    .modal-back{position:fixed;top:0;left:0;right:0;bottom:0;
      background:rgba(0,0,0,.4);display:flex;align-items:center;
      justify-content:center;z-index:999;display:none;}
    .modal{background:#fff;padding:24px;border-radius:8px;min-width:260px;}
    .modal h3{margin-top:0;}
  </style>
</head>

<body>
  <!-- ── 헤더 ─────────────────────────────────────────── -->
  <header>
    <span id="brand">🍜 Y‑map</span>
    <input id="search" type="text" placeholder="맛집 검색 (이름·주소)" />
    <button class="head-btn" id="nearbyBtn">내 주변</button>
    <button class="head-btn" id="loginBtn">로그인</button>
    <button class="head-btn" id="joinBtn">회원가입</button>
  </header>

  <!-- ── 지도 & 리스트 ───────────────────────────────── -->
  <div id="map"></div>
  <div id="list"></div>
  <div class="footer">powered by Leaflet & OpenStreetMap</div>

  <!-- ── 모달 (로그인/회원가입 placeholder) ───────────── -->
  <div class="modal-back" id="modalBack">
    <div class="modal">
      <h3 id="modalTitle"></h3>
      <p>데모용 UI입니다. 백엔드 연결 후 구현하세요 🙂</p>
      <button class="head-btn" onclick="modalBack.style.display='none'">닫기</button>
    </div>
  </div>

  <!-- ── Leaflet JS ─────────────────────────────────── -->
  <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js" defer></script>

  <!-- ── 앱 스크립트 ────────────────────────────────── -->
  <script defer>
  window.addEventListener('DOMContentLoaded', () => {
    if (!window.L) { alert('Leaflet 로드 실패'); return; }

    /* 1) 지도 ------------------------------------------------------------ */
    const map = L.map('map').setView([37.5665, 126.9780], 13);
    L.tileLayer(
      'https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png',
      { attribution:'© OpenStreetMap' }
    ).addTo(map);

    /* 2) 맛집 데이터 ----------------------------------------------------- */
    const places = [
      { name:'모찌라멘',  addr:'서울 중구 세종대로', lat:37.5665, lng:126.9780 },
      { name:'카레짱',    addr:'서울 중구 충무로',   lat:37.5651, lng:126.9895 },
      { name:'곱창의 정석', addr:'서울 중구 명동',   lat:37.5670, lng:126.9820 },
      { name:'돈카츠명가', addr:'서울 용산구 이태원', lat:37.5345, lng:126.9940 },
      { name:'모찌카페',  addr:'서울 강남구 강남대로',lat:37.4980, lng:127.0276 }
    ];

    /* 3) 마커·리스트 ---------------------------- */
    const listDiv   = document.getElementById('list');
    const markers   = [];
    const addPlace  = p => {
      const marker = L.marker([p.lat, p.lng])
        .bindPopup(`<strong>${p.name}</strong><br>${p.addr}`).addTo(map);

      const item = document.createElement('div');
      item.className = 'place';
      item.innerHTML = `<div class="place-name">${p.name}</div>
                        <div class="place-addr">${p.addr}</div>`;
      item.addEventListener('click', () => {
        map.setView([p.lat, p.lng], 17);
        marker.openPopup();
      });
      listDiv.appendChild(item);
      markers.push({marker,item,data:p});
    };
    places.forEach(addPlace);

    /* 4) 검색 필터 -------------------------------- */
    const searchInput = document.getElementById('search');
    searchInput.addEventListener('input', () => {
      const q = searchInput.value.trim().toLowerCase();
      markers.forEach(obj => {
        const match = (obj.data.name+obj.data.addr).toLowerCase().includes(q);
        obj.item.classList.toggle('hidden', !match);
        match ? map.addLayer(obj.marker) : map.removeLayer(obj.marker);
      });
    });

    /* 5) 내 주변 추천 ----------------------------- */
    const nearBtn = document.getElementById('nearbyBtn');
    nearBtn.addEventListener('click', () => {
      if (!navigator.geolocation) {
        alert('이 브라우저는 위치 서비스를 지원하지 않습니다.');
        return;
      }
      navigator.geolocation.getCurrentPosition(pos => {
        const {latitude, longitude} = pos.coords;
        const userLatLng = L.latLng(latitude, longitude);

        // ① 사용자 위치 마커
        L.marker(userLatLng, {icon:L.icon({
          iconUrl:'https://unpkg.com/leaflet@1.9.4/dist/images/marker-icon.png',
          iconAnchor:[12,41],popupAnchor:[0,-38]
        })}).addTo(map)
          .bindPopup('내 위치').openPopup();

        // ② 거리 계산하여 2km 이내만 추천
        const nearby = markers.filter(o => {
          return userLatLng.distanceTo([o.data.lat, o.data.lng]) <= 2000;
        });

        if (nearby.length===0){
          alert('반경 2km 내 추천 맛집이 없어요 😢');
          return;
        }

        // ③ 전체 마커/리스트 숨기고, 가까운 것만 보여주기
        markers.forEach(o=>{
          o.item.classList.add('hidden');
          map.removeLayer(o.marker);
        });
        nearby.forEach(o=>{
          o.item.classList.remove('hidden');
          map.addLayer(o.marker);
        });

        // ④ 지도 중심 이동
        map.setView(userLatLng, 15);
      }, err => {
        alert('위치 접근이 거부되었습니다 😢');
      });
    });

    /* 6) 로그인/회원가입 플래그 모달 ------------- */
    const modalBack = document.getElementById('modalBack');
    const modalTitle= document.getElementById('modalTitle');
    const openModal = title => {
      modalTitle.textContent = title;
      modalBack.style.display = 'flex';
    };
    document.getElementById('loginBtn').onclick = () => openModal('로그인');
    document.getElementById('joinBtn').onclick  = () => openModal('회원가입');
  });
  </script>
</body>
</html>