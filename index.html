<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Y-map ì›”ê³„ë™ ë§›ì§‘</title>

  <link rel="stylesheet"
        href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css"/>
  <style>
    body{margin:0;font-family:sans-serif;}
    header{background:#faeb1d;color:#fff;padding:12px 16px;font-size:20px;
           display:flex;align-items:center;gap:12px;flex-wrap:wrap;}
    #brand{font-size:22px;font-weight:700;margin-right:auto;}
    #search{flex:1;min-width:160px;max-width:220px;padding:6px 10px;
            border:none;border-radius:4px;}
    #category{min-width:110px;padding:6px 10px;border:none;border-radius:4px;}
    button.head-btn{background:#fff;border:none;border-radius:4px;padding:6px 14px;
                    cursor:pointer;font-weight:600;}
    #map{width:100%;height:60vh;}
    #list{padding:12px;}
    .place{cursor:pointer;margin:6px 0;padding:6px;border-bottom:1px solid #eee;
           display:flex;gap:10px;align-items:flex-start;}
    .place-thumb{width:60px;height:60px;object-fit:cover;border-radius:4px;}
    .place-info{flex:1;}
    .place-name{font-weight:600}
    .hidden{display:none;}
    .footer{text-align:center;font-size:14px;padding:8px;color:#666;}
    /* ëª¨ë‹¬ */
    .modal-back{position:fixed;inset:0;background:rgba(0,0,0,.45);
      display:none;align-items:center;justify-content:center;z-index:999;}
    .modal{background:#fff;padding:24px;border-radius:8px;min-width:260px;}
    .modal h3{margin-top:0;}
  </style>
</head>

<body>
  <header>
    <span id="brand">ğŸœ Y-map</span>

    <!-- ê²€ìƒ‰ì°½ -->
    <input id="search" type="text" placeholder="ë§›ì§‘ ê²€ìƒ‰ (ì´ë¦„Â·ì£¼ì†Œ)" />

    <!-- â˜… ì¹´í…Œê³ ë¦¬ ë“œë¡­ë‹¤ìš´ : ê²€ìƒ‰ì°½ ì˜† -->
    <select id="category">
      <option value="all">ì „ì²´</option>
      <option value="í•œì‹">í•œì‹</option>
      <option value="ì¤‘ì‹">ì¤‘ì‹</option>
      <option value="ì–‘ì‹">ì–‘ì‹</option>
      <option value="ì¹´í˜">ì¹´í˜</option>
    </select>

    <button class="head-btn" id="nearbyBtn">ë‚´ ì£¼ë³€</button>
    <button class="head-btn" id="loginBtn">ë¡œê·¸ì¸</button>
    <button class="head-btn" id="joinBtn">íšŒì›ê°€ì…</button>
  </header>

  <div id="map"></div>
  <div id="list"></div>
  <div class="footer">powered by Leaflet & OpenStreetMap</div>

  <!-- ëª¨ë‹¬ -->
  <div class="modal-back" id="modalBack" onclick="this.style.display='none'">
    <div class="modal" id="modalBox" onclick="event.stopPropagation();"></div>
  </div>

  <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js" defer></script>

<script defer>
window.addEventListener('DOMContentLoaded', () => {

  /* 1) ì§€ë„ ----------------------------------------------------------- */
  const map = L.map('map').setView([37.6250,127.0550], 15);
  L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png',
              {attribution:'Â© OpenStreetMap'}).addTo(map);

  /* 2) ë§›ì§‘ ë°ì´í„° (category í•„ë“œ í¬í•¨) ------------------------------ */
  const places = [
    { name:'ë¯¼ë“¤ë ˆëœ¨ë½', addr:'ë…¸ì›êµ¬ ì´ˆì•ˆì‚°ë¡œ2ê¸¸ 102',
      lat:37.633023,lng:127.057748,rating:4.6,category:'í•œì‹',
      review:'ëŒ€í•™êµ íšŒì‹ + ì¹œì ˆí•œ ê°€ê²©!',
      img:'https://images.unsplash.com/photo-1617196033535-996f98a5ca7f?auto=format&fit=crop&w=600&q=60' },
    { name:'ì˜¤ë³µì–‘í‰í•´ì¥êµ­', addr:'ë…¸ì›êµ¬ ì›”ê³„ë¡œ37ê¸¸ 5',
      lat:37.6247,lng:127.0529,rating:4.4,category:'êµ­ë°¥',
      review:'í•´ì¥êµ­ êµ­ë¬¼ì´ ëë‚´ì¤˜ìš”',
      img:'https://images.unsplash.com/photo-1604908812910-5f911f8a574d?auto=format&fit=crop&w=600&q=60' },
    { name:'ì¥ìˆ˜ê³±ì°½', addr:'ë…¸ì›êµ¬ ì„ê³„ë¡œ 20',
      lat:37.6232,lng:127.0561,rating:4.5,category:'ê³±ì°½Â·ê³ ê¸°',
      review:'ê³±ì°½ì´ ì‹ ì„ í•˜ê³  ì–‘ë…ì´ ì§„í•´ìš”',
      img:'https://images.unsplash.com/photo-1589308914961-426388972f70?auto=format&fit=crop&w=600&q=60' },
    { name:'ë¯¸ì†Œí•œìš°êµ­ë°¥', addr:'ë…¸ì›êµ¬ ì›”ê³„ë¡œ43ê¸¸ 3',
      lat:37.6273,lng:127.0550,rating:4.3,category:'êµ­ë°¥',
      review:'ì‚¬ê³¨ êµ­ë¬¼ì´ ê¹Šê³  ê¹”ë”!',
      img:'https://images.unsplash.com/photo-1553621042-f6e147245754?auto=format&fit=crop&w=600&q=60' },
    { name:'ë”ê·¸ë¦° ë¸ŒëŸ°ì¹˜ì¹´í˜', addr:'ë…¸ì›êµ¬ ë§ˆë“¤ë¡œ3ê¸¸ 20',
      lat:37.6225,lng:127.0595,rating:4.2,category:'ì¹´í˜',
      review:'ë§ì°¨ ë¼ë–¼ì™€ ìƒŒë“œìœ„ì¹˜ ì¶”ì²œ!',
      img:'https://images.unsplash.com/photo-1504674900247-0877df9cc836?auto=format&fit=crop&w=600&q=60' }
  ];

  const stars = r=>'â˜…â˜…â˜…â˜…â˜…'.slice(0,Math.round(r))+'â˜†â˜†â˜†â˜†â˜†'.slice(0,5-Math.round(r));

  /* 3) ë§ˆì»¤ Â· ë¦¬ìŠ¤íŠ¸ -------------------------------------------------- */
  const listDiv=document.getElementById('list');
  const markers=[];
  function addPlace(p){
    const marker=L.marker([p.lat,p.lng]).addTo(map).bindPopup(`
      <div style="text-align:center">
        <img src="${p.img}" style="width:140px;height:100px;object-fit:cover;border-radius:4px;"><br>
        <strong>${p.name}</strong><br>
        ${stars(p.rating)} (${p.rating.toFixed(1)})<br>
        <small>${p.category}</small><br>
        ${p.addr}<br>
        <em style="color:#555;">"${p.review}"</em>
      </div>`);
    const item=document.createElement('div');
    item.className='place';
    item.innerHTML=`
      <img class="place-thumb" src="${p.img}">
      <div class="place-info">
        <div class="place-name">${p.name}
          <span style="color:#ffb400;">${stars(p.rating)}</span>
          <span style="font-size:12px;color:#666;">(${p.rating.toFixed(1)})</span>
        </div>
        <div style="font-size:12px;color:#888;">${p.category}</div>
        <div class="place-addr">${p.addr}</div>
        <div style="font-size:12px;color:#555;">"${p.review}"</div>
      </div>`;
    item.onclick=()=>{map.setView([p.lat,p.lng],17);marker.openPopup();};
    listDiv.appendChild(item);
    markers.push({marker,item,data:p});
  }
  places.forEach(addPlace);

  /* 4) ê²€ìƒ‰ + ì¹´í…Œê³ ë¦¬ í•„í„° ------------------------------------------ */
  const searchInp=document.getElementById('search');
  const catSel=document.getElementById('category');
  function applyFilter(){
    const q=searchInp.value.trim().toLowerCase();
    const cat=catSel.value;
    markers.forEach(o=>{
      const txtMatch=(o.data.name+o.data.addr).toLowerCase().includes(q);
      const catMatch=(cat==='all'||o.data.category===cat);
      const show=txtMatch&&catMatch;
      o.item.classList.toggle('hidden',!show);
      show?map.addLayer(o.marker):map.removeLayer(o.marker);
    });
  }
  searchInp.addEventListener('input',applyFilter);
  catSel.addEventListener('change',applyFilter);

  /* 5) ë‚´ ì£¼ë³€ (ê¸°ì¡´) ----------------------------------------------- */
  document.getElementById('nearbyBtn').onclick=()=>{
    if(!navigator.geolocation) return alert('ìœ„ì¹˜ ì„œë¹„ìŠ¤ ë¯¸ì§€ì›');
    navigator.geolocation.getCurrentPosition(pos=>{
      const me=L.latLng(pos.coords.latitude,pos.coords.longitude);
      L.marker(me).addTo(map).bindPopup('ë‚´ ìœ„ì¹˜').openPopup();
      map.setView(me,15);
    },()=>alert('ìœ„ì¹˜ ì ‘ê·¼ ê±°ë¶€ë¨'));
  };

  /* 6) ë¡œê·¸ì¸ Â· íšŒì›ê°€ì… ëª¨ë‹¬ (ê¸°ì¡´) --------------------------------- */
  const modalBack=document.getElementById('modalBack');
  const modalBox=document.getElementById('modalBox');
  const tmpl={
    login:`<h3>ë¡œê·¸ì¸</h3>
      <label>ì´ë©”ì¼<br><input type="email" id="loginEmail"></label><br>
      <label>ë¹„ë°€ë²ˆí˜¸<br><input type="password" id="loginPw"></label><br><br>
      <button class="head-btn" onclick="alert('ë¡œê·¸ì¸!')">ë¡œê·¸ì¸</button>
      <button class="head-btn" onclick="modalBack.style.display='none'">ë‹«ê¸°</button>`,
    join:`<h3>íšŒì›ê°€ì…</h3>
      <label>ì´ë©”ì¼<br><input type="email" id="joinEmail"></label><br>
      <label>ë¹„ë°€ë²ˆí˜¸<br><input type="password" id="joinPw"></label><br>
      <label>ë¹„ë°€ë²ˆí˜¸ í™•ì¸<br><input type="password" id="joinPw2"></label><br><br>
      <button class="head-btn" onclick="alert('ê°€ì…!')">ê°€ì…í•˜ê¸°</button>
      <button class="head-btn" onclick="modalBack.style.display='none'">ë‹«ê¸°</button>`
  };
  function openModal(t){modalBox.innerHTML=tmpl[t];modalBack.style.display='flex';}
  document.getElementById('loginBtn').onclick=()=>openModal('login');
  document.getElementById('joinBtn').onclick=()=>openModal('join');

}); /* DOMContentLoaded */
</script>
</body>
</html>
